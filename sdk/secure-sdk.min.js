!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("secure",[],t):"object"==typeof exports?exports.secure=t():e.secure=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";!function(){function t(e,t){this.uc=e,this.client_id=t}var n={Ajax:{get:function(e,t,n){var r=new XMLHttpRequest;r.open("get",e,!0),r.setRequestHeader("Accept","application/json; charset=UTF-8"),r.onreadystatechange=function(){4==r.readyState&&(200==r.status||304==r.status?t&&t.call(this,JSON.parse(r.responseText)):n&&n.call(this,JSON.parse(r.responseText)))},r.send(null)}}};t.prototype.login=function(e,t,r,o,i){var c=this.uc+"/iam/api/login_hello?client_id="+this.client_id+"&tcode="+r;n.Ajax.get(c,function(n){if(n.data.secure_login_enable)if(n.data.public_key){var c=new JSEncrypt;c.setPublicKey(n.data.public_key);var a=c.encrypt(n.data.nonce+"-"+t);a=btoa(n.data.kid)+"."+a,o(e,a,r)}else{var u={error:"no_public_key",error_description:"应用需加密登录，但login_hello未生成公钥"};i(u)}else o(e,t,r)},function(e){i(e)})},t.prototype.encrypt=function(e,t,r){var o=this.uc+"/iam/api/login_hello?client_id="+this.client_id;n.Ajax.get(o,function(n){if(n.data.secure_login_enable)if(n.data.public_key){var o=new JSEncrypt;o.setPublicKey(n.data.public_key);var i=o.encrypt(n.data.nonce+"-"+e);i=btoa(n.data.kid)+"."+i,t(i)}else{var c={error:"no_public_key",error_description:"应用需加密登录，但login_hello未生成公钥"};r(c)}else t(e)},function(e){r(e)})},e.exports={Secure:t,util:n}}()}])});