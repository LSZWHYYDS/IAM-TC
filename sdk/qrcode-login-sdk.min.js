!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("qrcodesso",[],t):"object"==typeof exports?exports.qrcodesso=t():e.qrcodesso=t()}(this,function(){return function(e){function t(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,o){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,r){"use strict";var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e};!function(){function t(e,t,r){this.uc=e,this.options=o({},t),this.container=r,this._response={}}var r={Ajax:{post:function(e,t,o,n){var i=new XMLHttpRequest;i.open("POST",e,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),i.setRequestHeader("Accept","application/json; charset=UTF-8"),i.withCredentials=!0,i.onreadystatechange=function(){4==i.readyState&&(200==i.status||304==i.status?o&&o.call(this,JSON.parse(i.responseText)):n&&n.call(this,JSON.parse(i.responseText)))},i.send(r.postFormParams(t,!0))}},postFormParams:function(e,t){var r="";for(var o in e)if(e.hasOwnProperty(o)){var n=e[o];if(t&&!n)continue;r+="&"+o+"="+encodeURIComponent(e[o])}return r.substring(1)}};t.prototype.showQRCode=function(e,t){t.innerHTML="",new QRCode(t,{text:e,width:150,height:150,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}),t.querySelector("img").style.opacity="1"},t.prototype.authorize=function(){var e=this;this._response={};var t=o({},this.options);r.Ajax.post(this.uc+"/devicecode",t,function(t){e._response.device_code=t.device_code,e._response.expires_in=t.expires_in||300,e._response.interval=1e3*(t.interval||5),e._response.received_at=Date.now();if(e._response.expired_at=new Date(e._response.received_at+1e3*e._response.expires_in+1e4).getTime(),t.verification_uri&&t.user_code){var r=t.verification_uri+"?user_code="+encodeURIComponent(t.user_code);e.showQRCode(r,e.container),e.pollBinding(e.options.client_id,t.device_code)}},function(t){var r=t.error,o=t.error_description;e.container.innerHTML="<div>"+r+": "+o+"</div>"})},t.prototype.pollBinding=function(e,t){function o(){c.querySelector("img").style.opacity=".1",clearInterval(p);var e=c.querySelector(".q-qrcode-refresh");e||(e=document.createElement("img"),e.style="cursor:pointer;position:absolute;margin: -150px 100px;height:60px;width:60px;",e.src=s+"/img/qrcode-refresh.png",e.title="刷新二维码",e.classList.add("q-qrcode-refresh"),c.appendChild(e),e.onclick=function(){a(),e.remove()})}function n(e,t){if(Date.now()>t)return void o();r.Ajax.post(e+"/token",i,function(e){if(e.redirect_uri)return void(location.href=e.redirect_uri)},function(e){switch(e.error){case"invalid_request":case"expired_token":o()}})}var i={grant_type:"urn:ietf:params:oauth:grant-type:device_code",device_code:t,client_id:e},s=this.uc,c=this.container,a=this.authorize.bind(this),p=setInterval(n,this._response.interval,this.uc,this._response.expired_at)},e.exports={QRCodeLogin:t,util:r}}()}])});